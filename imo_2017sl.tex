\documentclass[11pt,a4paper]{article}
\usepackage{amsmath, amssymb, fullpage, mathrsfs, bm, pgf, tikz}
\usepackage{mathrsfs}
\usetikzlibrary{arrows}
\setlength{\textheight}{10in}
%\setlength{\topmargin}{0in}
\setlength{\topmargin}{-0.5in}
\setlength{\parskip}{0.1in}
\setlength{\parindent}{0in}

\begin{document}
\newcommand{\la}{\leftarrow}
\newcommand{\lra}{\leftrightarrow}


\title{Solution to IMO 2017 shortlisted problems.}
\author{Anzo Teh}
\date{\today}
\maketitle

\newpage
\section{Algebra}
\begin{enumerate}
	\item[\textbf{A1}]Let $a_1,a_2,\ldots a_n,k$, and $M$ be positive integers such that
	$$\frac{1}{a_1}+\frac{1}{a_2}+\cdots+\frac{1}{a_n}=k\quad\text{and}\quad a_1a_2\cdots a_n=M.$$If $M>1$, prove that the polynomial
	$$P(x)=M(x+1)^k-(x+a_1)(x+a_2)\cdots (x+a_n)$$has no positive roots.
	
	\textbf{Solution.} We will actually prove that $(x+a_1)(x+a_2)\cdots (x+a_n) > M(x+1)^k$ for all $x > 0$. 
	Now, dividing by $M$ on both sides (i.e. dividing by $a_1a_2\cdots a_n$ on the left hand side) (bearing in mind that $M$ is positive) we get that the desired inequality is equivalent to 
	$(1+\frac{x}{a_1})(1+\frac{x}{a_2})\cdots (1+\frac{x}{a_n}) = \frac{x+a_1}{a_1}\cdot\frac{x+a_2}{a_2}\cdots \frac{x+a_n}{a_n} > (x+1)^k$. 
	
	Before we proceed, we prove a key fact: for all $x > 0$ and all $i$ we have $(1+\frac{x}{a_i})^{a_i} \ge 1+x$, with equality happening if and only if $a_i = 1$. Here I will show two proofs to it: 
	\begin{itemize}
		\item Expanding the left hand side (thankfully $a_i$ is a positive integer) gives 
		\[(1+\frac{x}{a_i})^{a_i}=\sum_{j=0}^{a_i}\binom{a_i}{j}x^j=1+x+\sum_{j=2}^{a_i}\binom{a_i}{j}x^j\]
		Clearly the last term is positive if $x>0$ and $a_i>1$. 
		\item Consider the expression $f(x)=(1+\frac{x}{a_i})^{a_i} - (1+x)$, where $f(0)=0$ and $f'(x)=(1+\frac{x}{a_i})^{a_i-1}-1$. This derivative is positive if $x>0$ and $a_i-1>0$ (i.e. $a_i=1$), which will follow that $f(x)>0$ for all $x>0$ if $a_i>1$. 
	\end{itemize}
Thus we have $(1+\frac{x}{a_i}) \ge (1+x)^{\frac{1}{a_i}}$ for all $x>0$ with equality iff $a_i=1$. This means, 
$(1+\frac{x}{a_1})(1+\frac{x}{a_2})\cdots (1+\frac{x}{a_n}) \ge (x+1)^{\frac{1}{a_1}+\frac{1}{a_2}+\cdots + \frac{1}{a_n}}=(x+1)^k$, with equality iff $a_i=1$ for all $i$. This cannot happen, otherwise $M=1$. So the strict inequality always holds. 

\item [\textbf{A2}] Let $q$ be a real number. Gugu has a napkin with ten distinct real numbers written on it, and he writes the following three lines of real numbers on the blackboard:
	\begin{itemize}
		\item In the first line, Gugu writes down every number of the form $a-b$, where $a$ and $b$ are two(not necessarily distinct) numbers on his napkin.
		\item In the second line, Gugu writes down every number of the form $qab$, where $a$ and $b$ are
		two (not necessarily distinct) numbers from the first line.
		\item In the third line, Gugu writes down every number of the form $a^2+b^2-c^2-d^2$, where
		$a, b, c, d$ are four (not necessarily distinct) numbers from the first line.
	\end{itemize}
	Determine all values of $q$ such that, regardless of the numbers on Gugu's napkin, every number in the second line is also a number in the third line.
	
	\textbf{Answer.} $0$ and $\pm 2$. \\
	\textbf{Solution.} Let $a_1, \cdots , a_{10}$ be the numbers on the napkin. Then the numbers on the first line are in the form of $a_i - a_j$ with $1\le i, j\le 10$. Thus all the numbers on the second line are in the form of $q(a_i - a_j)(a_k-a_\ell)$, and the numbers on the third line is in the form of $(a_{11}-a_{12})^2 + (a_{21}-a_{22})^2 - (a_{31}-a_{32})^2 - (a_{41}-a_{42})^2$. Thus letting $q=0$ yields all numbers on the second line as 0, which we can choose $a_{11}=a_{12}=\cdots = a_{41}=a_{42}$. Now for $q=2$ we have 
	$2(a_i - a_j)(a_k-a_\ell)=(a_j-a_k)^2 + (a_i-a_\ell)^2 - (a_i-a_k)^2 - (a_j-a_\ell)^2$ and for $q=-2$ we have 
	$(a_i - a_j)(a_k-a_\ell)= (a_i-a_k)^2 + (a_j-a_\ell)^2 - (a_j-a_k)^2 - (a_i-a_\ell)^2$. Thus these are all valid values. 
	
	To show that these are the only values, consider when $a_i=i$, so the numbers on the first line are $-9, -8, \cdots , 8, 9$. Thus $q(1)(1)=q$ is on the second line, and all numbers on the third line are integers. It then follows that $q$ is an integer. Next, $q(9)(9)=9^2\cdot q$ is on the second line while the numbers on the third line cannot exceed $9^2+9^2=2\cdot 9^2$ and cannot be less than $-(9^2+9^2)=-2\cdot 9^2$. It then follows that $-2\le q\le 2$. This left with 5 choices: $-2, -1, 0, 1, 2$. Finally, to see why $\pm 1$ doesn't work, consider a new sequence $-\pi, 0, 1, \cdots , 8$ on the napkin, so the first line contains the numbers $\pm(i + \pi j)$ where $i\in \{0, 1, \cdots , 8\}$ and $j\in\{0, 1\}$. Therefore the number $q(1)(1+\pi)=q+q\pi$ is indeed on the second line. The numbers on the third line are in the form of $a\pi^2+b\pi + c$. Notice that $b$ must be even, since each of the summand $\pm (i+\pi j)^2=\pm (i^2+2\pi ij + \pi^2 j^2)$, with the coefficient of $\pi$ equal to $2ij$, which is even. Now there must be a combination of the four numbers that gives $a=0$, $b=c=q$ since $\pi$ is transcendental (i.e. $a'\pi^2+b'\pi+c'=0$ means that $a'=b'=c'=0$). The fact that $b$ must be even means that $q$ must also be even, so $q=\pm 1$ doesn't work. 
	
\end{enumerate}

\section{Combinatorics}
\begin{enumerate}
	\item[\textbf{C1}] A rectangle $\mathcal{R}$ with odd integer side lengths is divided into small rectangles with integer side lengths. Prove that there is at least one among the small rectangles whose distances from the four sides of $\mathcal{R}$ are either all odd or all even. 
	
	\textbf{Solution.} Consider partitioning this big rectangle into small squares of side length 1, and colour it in the chessboard fashion, with the corners being black (all corners have the same colour since the sides lengths are both odd). This also implies the number of black squares is exactly one more than that of white squares, so there must contain a small rectangle that contains more black square than white squares. This will only happen when all this small rectangle has all four corners having black square. Now each of the four corners correspond to two adjacent sides of $\mathcal{R}$, and its distance from the two adjacent sides are both odd and both even if and only if it's coloured black. Since all these four corners are all black squares, the distance of the small rectangle from all four pairs of adjacent sides have the same parity, hence having the same parity to all the sides of $\mathcal{R}$. 
	
	\item[\textbf{C2}] Let $n$ be a positive integer. Define a chameleon to be any sequence of $3n$ letters, with exactly $n$ occurrences of each of the letters $a, b,$ and $c$. Define a swap to be the transposition of two adjacent letters in a chameleon. Prove that for any chameleon $X$ , there exists a chameleon $Y$ such that $X$ cannot be hanged to $Y$ using fewer than $3n^2/2$ swaps.
	
	\textbf{Solution.} For each of the $n^2$ pairs of $(a, b)$ we denote $s_{ab}$ to be the number of pairs of $(a, b)$ such that $a$ comes before $b$. Definte $s_{ba}, s_{ac}, s_{ca}, s_{bc}, s_{cb}$, respectively. Notice also that $s_{ab}+s_{ba}=s_{ac} + s_{ca}= s_{ac} + s_{ca} = n^2$. We first proceed with a lemma: at each swap of characters $i$ and $j$ (assume $i\neq j$ otherwise we just get one free swap without changing the sequence), the numbers $s_{ij}$ and $s_{ji}$ each changes by exactly one. To see why, if another character, say $k$, is not involved in the swap, then it comes before any other character $\ell$ after a swap if and only if it comes before that character $\ell$ before the swap. The only characters that can cause a change in the values $s_{\text{anything}}$ are $i$ and $j$ themselves, which will cause $s_{ij}$ to decrease by 1 and $s_{ji}$ to increase by 1 (asuming the sequenc changes from $ij$ to $ji$). 
	
	Now, to make this string $s$ to match another string $t$, we must have $s_{ij}=t_{ij}$ for any combination of $ij$, Consider the strings $t_1=a\cdots ab\cdots bc\cdots c$ and $t_2=c\cdots cb\cdots ba\cdots a$. In the first example, $t_{ab}=n^2, t_{ba}=0, t_{ac}=n^2, t_{ca}=0, t_{bc}=n^2, t_{cb}=0$; in the second example it's just the opposite: $t_{ab}=0, t_{ba}=n^2, t_{ac}=0, t_{ca}=n^2, t_{bc}=0, t_{cb}=n^2$. To change from $s$ to $t_1$ there must be at least $s_{ba}+s_{ca}+s_{cb}$ swaps; to change from $s$ to $t_2$ there must be at least $s_{ab}+s_{ac}+s_{bc}$ swaps. These two expressions add up to $3n^2$, so one of them must be at least $3n^2/2$. 
	
	\item[\textbf{C3}]Sir Alex plays the following game on a row of 9 cells. Initially, all cells are empty. In each move, Sir Alex is allowed to perform exactly one of the following two operations:
	\begin{itemize}
	\item Choose any number of the form $2^j$, where $j$ is a non-negative integer, and put it into an empty cell.
	\item Choose two (not necessarily adjacent) cells with the same number in them; denote that number by $2^j$. Replace the number in one of the cells with $2^{j+1}$ and erase the number in the other cell.
	\end{itemize}
	At the end of the game, one cell contains $2^n$, where $n$ is a given positive integer, while the other cells are empty. Determine the maximum number of moves that Sir Alex could have made, in terms of $n$.
	
	\textbf{Answer.} $2\sum_{i=1}^8\dbinom{n}{i} - 1$. \\
	\textbf{Solution.} We first show that in the process of creating the $2^n$, the sum of the numbers in nonempty cells at any moment must have at most 8 ones in its binary representation. To see why, we claim that $2^{a_1}+\cdots + 2^{a_k}$ has at most $k$ digits in its binary representation with equality if and only if all $a_i$'s are pairwise distinct. We proceed by induction: $k=1$ is clear. Now suppose that $c=2^{a_1}+\cdots + 2^{a_k}$ has at most $k$ one's in its binary expansion, and consider $c+2^{a_{k+1}}$. Let $j$ to be the least index $\ge a_{k+1}$ that has 0 on the binary representation of $c$, then $c+2^{a_{k+1}}$ has 1 on $j$ and 0 on all $i$ for all $i < j$ and $i \ge a_{k+1}$. Hence the net change of the 1's is $1 - (j - a_{k+1})\le 1$, with equality iff $j=a_{k+1}$, i.e. no bits flipped from 1 to 0. This established our boundary. As for the equality case, it means that there is no bits flipped from 1 to 0 at all, which follows that $a_1, a_2, \cdots a_k$ must be all distinct (it will become clear if we arrange the numbers in the way $a_1\ge\cdots a_k$). The fact that there are only 9 cells means that there are at most 9 one's in any numbers at all times. However, if equality actually holds, then all the nine numbers $2^{a_1}, \cdots , 2^{a_9}$ are pairwise different. The first operation cannot be done since there is no empty cell; the second operation cannot be done either since there is no two cells with the same number. This means the game must end here, but it doesn't end with the state of $2^n$ as desired. This shows that any number (that is the sum of the non-empty cells) any time has at most 8 one's in its binary digits. 
	
	Now we show that Sir Alex can do the algorithm such that all numbers with at most 8 one's and $\le 2^n$ can be sum of cells at some time. Now we identify all such numbers and sort it in ascending order. We use a stronger claim: we can do it such that at some point, any number with at most 8 one's is presented on the grid, represented exactly in the way of binary representation. Again we use induction, and we consider the next number with this property. We start with 0, obviously. At each point, suppose the number $c$ is represented on the grid in the manner we desire. We now have two cases: 
	\begin{itemize}
		\item If $c$ has at most 7 digits that are ones, then we can add another one at the cells. If $c$ is now even we are done (since $c+1$ will have 1 more one than $c$); otherwise, let $j$ be the minimal index such that the digits 0 to $j$ are all one. This means that $2^j, 2^{j - 1}. 1$ are all in the cells and, after adding 1, we can iteratively merge them so that a single 1 is left. 
		\item Otherwise, $c$ has exactly 8 digits. If $j$ is the least index such that $c$ has 1 at digit $j$, then the next number with the desired property is $c+2^{j}$ ($c+d$ with $1\le d<2^j$ has more digit than $c$ since $c$ is divisible by $2^j$). Now we add $2^j$, and do the merging in a fashion similar to the first case; the resulting configuration would be optimal. 
	\end{itemize}

Summarizing above, we will have $\sum_{i=1}^8\dbinom{n}{i}$ numbers represented in the process. This means $\sum_{i=1}^8\dbinom{n}{i}$ insertion of cell is done, which means the number of nonempty cells has been increased by $\sum_{i=1}^8\dbinom{n}{i}$ times. Since there is only one cell left, there are $\sum_{i=1}^8\dbinom{n}{i}-1$ decrement of the number cells, i.e. merging. Hence the total numbers of moves is $2\sum_{i=1}^8\dbinom{n}{i}-1$. 
\end{enumerate}

\section{Geometry}
\begin{enumerate}
	\item[\textbf{G1}] Let $ABCDE$ be a convex pentagon such that $AB=BC=CD$, $\angle{EAB}=\angle{BCD}$, and $\angle{EDC}=\angle{CBA}$. Prove that the perpendicular line from $E$ to $BC$ and the line segments $AC$ and $BD$ are concurrent.
	
	\textbf{Solution.} Let $P$ be the intersection of the diagonals $AC$ and $BD$, and $Q$ be the intersection of circles $ABP$ and $CDP$. Now, by angle chasing we get $\angle AQB=\angle APB=\angle CPD=\angle CQD$ and $\angle BAQ=\angle DPQ=\angle DCQ$, so the triangles $BAQ$ and $DCQ$ are similar. Since $AB=CD$, these triangles are in fact congruent, so $AC=CQ$ and $BQ=DQ$. Now, this means that $BQ$ is the perpendicular bisector of $AC$ and $CQ$ is the perpendicular bisector of $BD$. Thus $P$ is the orthocenter of triangle $BQC$. 
	
	The next step is to show that $E, P, Q$ are collinear, which finished the proof. To achieve this, we first observe that $\angle BAQ=\angle DPQ= 90^{\circ}-\angle PQC=90^{\circ} - \angle CBQ$. Now, $\angle BAE=\angle BCD=180^{\circ} - \angle CBQ - \angle CQB = 180^{\circ} - 2\angle CBQ=2\angle BAQ$, so $AQ$ is an angle bisector of $BAE$. We also know that $BQ$ bisects $\angle ABC$ since $BQ$ is the perpendicular bisector of $AC$, so the distance from $Q$ to lines $BC, BA, AE$ are equal. Similarly the distance from $Q$ to lines $BC, CD, DE$ are equal. Thus $EQ$ bisects $AED$ too. To see that $E, P, Q$ are collinear, or equivalently $EQ$ is perpendicular to $BC$, it suffices to show that if $EA$ and $ED$ intersect $BC$ at $L$ and $M$, respectively, then we have $EL=EM$. This is indeed true as it can be computed that $\angle ELM=\angle EML=180^{\circ} - 2\angle BAC- 2\angle CBD$. 
	
	\item[\textbf{G2}] Let $R$ and $S$ be different points on a circle $\Omega$ such that $RS$ is not a diameter. Let $\ell$ be the tangent line to $\Omega$ at $R$. Point $T$ is such that $S$ is the midpoint of the line segment $RT$. Point $J$ is chosen on the shorter arc $RS$ of $\Omega$ so that the circumcircle $\Gamma$ of triangle $JST$ intersects $\ell$ at two distinct points. Let $A$ be the common point of $\Gamma$ and $\ell$ that is closer to $R$. Line $AJ$ meets $\Omega$ again at $K$. Prove that the line $KT$ is tangent to $\Gamma$.
	
	\textbf{Solution.} One of the most crucial claim to the proof is that $AT\parallel KR$. To see why, $\angle TRK = \angle SRK = \angle SJK = \angle ATS=\angle ATR$. Next, since $AR$ is tangent to $\Omega$, we have $\angle ART=\angle ARS=\angle SKR$. Thus triangles $RKS$ and $TRA$ are similar. Now, let $B$ to be such that $A$ is the midpoint of $BT$. We have $\angle BAR=\angle TSK$ and $\frac{BA}{AR}=\frac{AT}{AR}=\frac{SR}{SK}$, so triangles $BAR$ and $TSK$ are also similar. Finally, since $S$ is the midpoint of $RT$ and $A$ the midpoint of $BT$, we have $BR\parallel AS$, so $\angle RTK=\angle RBA=\angle SAT$. The last inequality means that $KT$ is tangent to $\Gamma$. 
	
	\item[\textbf{G4}] In triangle $ABC$, let $\omega$ be the excircle opposite to $A$. Let $D, E$ and $F$ be the points where $\omega$ is tangent to $BC, CA$, and $AB$, respectively. The circle $AEF$ intersects line $BC$ at $P$ and $Q$. Let $M$ be the midpoint of $AD$. Prove that the circle $MPQ$ is tangent to $\omega$.
	
	\textbf{Solution.} We first show that if $J\neq D$ is the second intersection of $AD$ with the excircle $\omega$ then $J$ lies on the circle $MPQ$, Let $I$ be the $A$-excenter, then $\angle AEI=\angle AFI=90^{\circ}$, so $I$ lies on circle $AEF$. Let $G\neq D$ be the second intersection of $AD$ with circle $AEF$, then $\angle AGI=\angle DGI=90^{\circ}$. Sincd $DJ$ is a chord on the excircle, and $G$ is the perpendicular from the cetner $I$ to $DJ$, $DG=GJ$. Finally, since $A, P, Q, E, F, G$ are concyclic, $PD\cdot DQ=AD\cdot DG=2MD\cdot DG=MD\cdot 2DG=MD\cdot DJ$, completing the proof of this claim. 
	
	It remains to show that circles $MPQ$ and $\omega$ are tangent at $J$. Let $PQ$ and $EF$ intersect at $H$ (possibly point of infinity), then since $PQ$ is the radical axis of circles $AEF$ and $MPQ$ and $EF$ the radical axis of $AEF$ and $\omega$, $H$ is the radical center of the three circles (i.e. the radical axis of $MPQ$ and $\omega$). Now, the tangents to $\omega$ at $E$, $C$, and line $DJ$ concur at $A$, so quadrilateral $EDCJ$ is harmonic. This means that the tangents to $\omega$ at $D$, at $J$, and $EF$ are concurrent too. Since $PQ$ is tangent to $\omega$, these lines must concur at $H$. We then conclude then $HJ$ is tangent to $\omega$ and since $HJ$ is the radical axis of $\omega$ and $MPQ$, they are indeed tangent. 
	\end{enumerate}

\section{Number Theory}
\begin{enumerate}
	\item[\textbf{N1}](IMO \#1) For each integer $a_0 > 1$, define the sequence $a_0, a_1, a_2, \ldots$ for $n \geq 0$ as
	$$a_{n+1} = 
	\begin{cases}
	\sqrt{a_n} & \text{if } \sqrt{a_n} \text{ is an integer,} \\
	a_n + 3 & \text{otherwise.}
	\end{cases}
	$$Determine all values of $a_0$ such that there exists a number $A$ such that $a_n = A$ for infinitely many values of $n$.
	
	\textbf{Answer.} All $n$ divisible by 3. \\
	\textbf{Solution.} 
	For the first part we show the that if $3\nmid a_0$, then $a_i\equiv 2\pmod{3}$ for some $i$. Notice first that if $3\nmid a_i$ then $3\nmid a_{i+1}$ (regardless whether $a_i$ is a perfect square). If $a_0$ has remainder 2 modulo 3 we are done. Otherwise, $a_0\equiv 1\pmod{3}$ so $a_0+3k$ is a perfect square for some $k$. Find the minimal such $k$, and we have $a_k=a_0+3k=c^2$ for some $c$, and $a_{k+1}=c$. If $c\equiv 2\pmod{3}$ we are done. Otherwise, we have $c\ge 4$ and $c-2\equiv 2\pmod{3}$ so $(c-2)^2\equiv 1\pmod{3}$, showing that $a_0\ge (c-2)^2+3$. With $c\ge 4$ we have $(c-2)^2+3 > c$, so $a_0>a_{k+1}$. Letting $0=b_0$ and $b_1, b_2, \cdots$ be indices such that $a_{b_i}$ is a perfect square yields that $a_{b_0}>a_{b_1}>\cdots$, so this sequence must terminate, meaning that we have $a_i\equiv 2\pmod{3}$ for some $i$. Now it's easy to prove that this $a_i$ cannot be a perfect square, so for all $j>0$ we have $a_{i+j}=a_i+3j$, showing that all numbers appear a finite number of times. 
	
	For the case where $3|a_0$ we will do something similar: keep looking for the next square. Again let $k$ be the least index with $a_k$ a perfect square, say, $c^2$. Then $a_0\ge (c-3)^2+3$ because $3|c$. Now if $c>3$ then $c=a_{k+1}>a_0$, so again constructing the sequence $b_0, b_1, \cdots$ gives $a_{b_0}>a_{b_1}>\cdots$, hence it must terminate. The only way to terminate is when $c\le 3$, in which the equality must hold since $a_i>0$ for all $i$. Hence the sequence goes $3\to 6\to 9\to 3\to 6\to 9$, so each of $3, 6, 9$ appears infinitely many times. 
	
	\item[\textbf{N2}]Let $ p \geq 2$ be a prime number. Eduardo and Fernando play the following game making moves alternately: in each move, the current player chooses an index $i$ in the set $\{1,2,\ldots, p-1 \}$ that was not chosen before by either of the two players and then chooses an element $a_i$ from the set $\{0,1,2,3,4,5,6,7,8,9\}$. Eduardo has the first move. The game ends after all the indices have been chosen .Then the following number is computed:
	$$M=a_0+a_110+a_210^2+\cdots+a_{p-1}10^{p-1}= \sum_{i=1}^{p-1}a_i10^i$$
	The goal of Eduardo is to make  $M$ divisible by $p$, and the goal of Fernando is to prevent this.
	
	Prove that Eduardo has a winning strategy.
	
	\textbf{Solution.} If $p=2$ or $p=5$, Eduardo just have to choose $a_0=0$ and the games is his, forever. Hence from now on we assume that $\gcd(p, 10)=1$. Eduardo first lets $a_{p-1}=0$. Then he considers $10^j\pmod{p}$ for $j=0, \cdots , p-2$, and consider the minimum $k$ such that $10^k=1\pmod{p}$. Now two cases arise: 
	\begin{itemize}
		\item If $k$ is even, then it must happen that $10^{k/2}\equiv -1\pmod{p}$. Now pair the indices $0, 1, \cdots , p-2$ in the following manner: if $j=ak+b$ with $0\le b<k$ then pair $j$ with $j + k/2$ if $b<k/2$, and with $j - k/2$ otherwise. Now notice that if $j, \ell$ are a pair then $10^j$ and $10^{\ell}$ are negatives of each other, and these pairs form a partition of the numbers $0, 1, \cdots , p - 2$. Now at each turn, Fernando chooses $j$ and $a_j$, and is $j$ is paired with $\ell$ then Eduardo chooses $\ell$ with $a_\ell = a_j$, so that $a_j10^j+a_\ell10^{\ell}\equiv 0\pmod{p}$. This will allow $p|M$ in the end. 
		\item Otherwise, let $b_j=10^j$ for all $0, 1, \cdots , k-1$. Notice that $(p-1)/k$ must be even, so for each $j$ there are an even number of indices $\ell$ with $10^{\ell}\equiv b_j\pmod{p}$. Now for each $j$ and all such $(p-1)/k$ $\ell$'s, we pair the indices arbitrarily (so that there are $(p-1)/2k$ pairs). Each time when when Fernando chooses $j$ and $a_j$, and suppose that $j$ is paired with some $\ell$, Eduardo chooses $a_\ell=9-a_j$, so that the contribution to $M$ mod $p$ is $9b_j$. Therefore, the resulting $M$ has congruence $\sum 9*(p-1)*b_j/(2k)=9*(p-1)/2k\sum b_j$. If $p=3$ the factor 9 already implies $3|M$. Otherwise, notice that $(p-1)/k\sum b_j=\sum_{i=0}^{p-2}10^{j}=\frac{10^{p-1}-1}{10-1}$, which is divisible by $p$ since $p|10^{p-1}-1$ by Fermat's little theorem, and $p\nmid 9=10-1$ for $p\neq 3$. Since $(p-1)/k$ is not a multiple of $p$, $\sum b_j$ is a multiple of $p$, and so is $9*(p-1)/2k\sum b_j$ and $M$. 
	\end{itemize}
	\end{enumerate}

\end{document}